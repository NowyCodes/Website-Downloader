// Option A - recommended: release asset you upload (change the filename if different)
const DOWNLOAD_URL = "https://github.com/NowyCodes/Website-Downloader/releases/latest/download/website-downloader-source.zip";

// Option B - alternate: use GitHub autogenerated source zip for a tag (if you DO NOT upload an asset).
// Replace v1.0.0 with the release tag you create.
// const DOWNLOAD_URL = "https://github.com/NowyCodes/Website-Downloader/archive/refs/tags/v1.0.0.zip";

const downloadPrimary = document.getElementById("downloadPrimary");
const downloadFloating = document.getElementById("downloadFloating");
const modal = document.getElementById("downloadModal");
const modalClose = document.getElementById("modalClose");
const downloadZip = document.getElementById("downloadZip");

let lastFocused = null;
function openModal() {
  lastFocused = document.activeElement;
  modal.setAttribute("aria-hidden", "false");
  modalClose.focus();
  document.body.style.overflow = "hidden";
  document.addEventListener("keydown", handleKeydown);
}
function closeModal() {
  modal.setAttribute("aria-hidden", "true");
  document.body.style.overflow = "";
  document.removeEventListener("keydown", handleKeydown);
  if (lastFocused) lastFocused.focus();
}

function handleKeydown(e) {
  if (e.key === "Escape") closeModal();
}

downloadPrimary.addEventListener("click", openModal);
downloadFloating.addEventListener("click", openModal);
modalClose.addEventListener("click", closeModal);
modal.querySelectorAll("[data-close]").forEach(el => el.addEventListener("click", closeModal));

downloadZip.addEventListener("click", () => {
  window.location.href = DOWNLOAD_URL;
  closeModal();
});

// Show modal once for first-time visitors
if (!localStorage.getItem("downloadPromptShown")) {
  setTimeout(() => {
    openModal();
    localStorage.setItem("downloadPromptShown", "1");
  }, 3000);
}
